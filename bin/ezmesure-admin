#!/usr/bin/env node

/* eslint-disable no-console */
/* eslint-disable max-len */

const program = require('commander');
const pkg = require('../package.json');

const libSpaces = require('./cmds/spaces');
const objects = require('./cmds/objects');
const dashboard = require('./cmds/dashboard');
const usersCmd = require('./cmds/users');
const rolesCmd = require('./cmds/roles');


program.on('command:*', () => {
  console.error(`Invalid command: ${program.args.join(' ')}\nSee --help for a list of available commands.`);
  process.exit(1);
});

program
  .version(pkg.version)
  .command('spaces [space]')
  .option('-a, --all', 'display all data')
  .option('-j, --json', 'display data in JSON format')
  .description('List all KIBANA spaces or [space] space attributes')
  .action((space, opts) => {
    libSpaces.getSpaces(space, opts);
  });

program
  .command('space-add <space>')
  .option('-c, --color <color>', 'color of space')
  .option('-d, --desc <description>', 'description of space')
  .option('-i, --initials <initials>', 'initials of space')
  .description('Add a KIBANA space with default attributes')
  .action((space, opts) => {
    libSpaces.addSpaces(space, opts);
  });

program
  .command('space-del <spaces...>')
  .description('Delete a KIBANA space')
  .action((spaces) => {
    libSpaces.delSpaces(spaces);
  });

program
  .command('objects-find <type>')
  .description('Find KIBANA objects (objects: visualization, dashboard, search, index-pattern, config, timelion-sheet)')
  .option('-s, --space <space>', 'target space')
  .option('-t, --title <title>', 'title of object, is a key word (ex: univ-lorraine)')
  .option('-j, --json', 'display data in JSON format')
  .action((type, opts) => {
    objects.findObjects(type, opts);
  });

program
  .command('dashboard-export <dashboardId>')
  .description('Export dashboard by Id')
  .option('-s, --space <space>', 'name of target space')
  .action((dashboardId) => {
    dashboard.exportDashboard(dashboardId);
  });

program
  .command('dashboard-move-in-space <space> <dashboards...>')
  .description('Move dashboard by Id(s) in another space')
  .option('-n, --new', 'create new space')
  .action((space, dashboards, opts) => {
    dashboard.importDashboardInSpace(space, dashboards, opts);
  });

program
  .command('users [users...]')
  .description('Get all users list or a specific user')
  .option('-j, --json', 'display data in JSON format')
  .action((user, opts) => {
    usersCmd.getUsers(user, opts);
  });

program
  .command('roles [roles...]')
  .description('Get all roles list or a specific role')
  .option('-j, --json', 'display data in JSON format')
  .action((role, opts) => {
    rolesCmd.getRoles(role, opts);
  });

program
  .command('add-role <role> <usernames...>')
  .description('Add role to user(s)')
  .action((role, usernames) => {
    rolesCmd.addRole(role, usernames);
  });

program
  .command('del-role <role> <usernames...>')
  .description('Delete role to user(s)')
  .action((role, usernames) => {
    rolesCmd.delRole(role, usernames);
  });

program.parse(process.argv);
